---
title: "Subnational V-Dem in Colombia: Data wrangle"
author: "Patrick McQuestion"
date: "First version: February 4, 2023. This version: `r format(Sys.Date(), '%d %B %Y')`."
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("G:/My Drive/git/snvdem24")

library(dplyr)
library(tidyverse)
library(tidymodels)
library(haven)
library(readxl)

```

# Data Wrangling: SN V-Dem in Colombia

Final product should be a "Colombia Municipal panel dataset" (CMPD): Time-series dataset composed of municipality-year observations as far back as 1900. V-Dem data goes back to that date. We anticipate that the layering of the subnational response variables can reveal unnevenness below the regional or departmental-level. 

## Step 1: Municipal data (Cross-section 2018)
In order to merge tables to the shapefile maps of Colombia, it is necessary to retain a key ID, in this case the official DANE code, for each municipality. 

```{r, CS_0, include=FALSE, echo=FALSE}
#In this case, we use a .dbf table from a DANE Census data shapefile from 2018, in order to facilitate merging later on. Data dictionary is in geospatial/MGN_ANM_MPIOS
library(readxl)
Col2018 <- read_excel("G:/My Drive/git/snvdem24/data/panel/Colombia2018_data.xls") 

# Select only relevant variables. Final columns are from a DANE 2024 file that contains regional information. 

Col2018 <- Col2018 %>%
  select(1:10|37|70|73:74|90:95) 

```

The following code is for merging together the relevant data for mapping V-Dem response variables. 

### 1.1  Rurality (V-Dem response variables #0-1)

### 1.2  Economic development (V-Dem response variables #2-3) 

### 1.3  Capital city (V-Dem response variables #4-5)

### 1.4  Cardinal directions (V-Dem response variables #6-9) 
```{r, MD_4, include=FALSE, echo=FALSE}
# The variable "Cardinal" was created in ArcMap by combining regions, somewhat arbitrarily:
# if REGION 'Caribe', 'Eje Cafetero - Antioquia': 'North'
# REGION 'Centro Oriente', 'Llano': 'East'
# REGION 'Centro Sur': 'South'
# REGION 'Pacifico': 'West'.
# Note: This could be adjusted according to other criteria. 
```

### 1.5  Civil unrest (V-Dem response variable #10) 

### 1.6  Illicit activity (V-Dem response variable #11) 

### 1.7  Sparse population density (V-Dem response variable #12) 

### 1.8  Remoteness (V-Dem response variable #13) 

### 1.9  Indigenous (V-Dem response variable #14) 

### 1.10  National ruling party (V-Dem response variable #15-16) 


## Step 2: Panel (time-series)

This step will expand the dataset to time-series (\~1900-2022).

Note: 
- CEDE has combined a panel dataset with historical data from Colombia related to economics, violence, education, and other dynamics.
- [Terridata](https://terridata.dnp.gov.co/index-app.html#/descargas) has more recent data.


## Step 3: Merge V-Dem responses
This will include visualizing layers.

## Step 4: Spatial analysis of democracy and development outcomes
(See more in Patrick's Causal Inference code)

### Education

-   coverage (feasible enrollment rate, sessions)

-   infrastructure (establishments)

-   test scores (Saber11 in math and reading)

-   others (e.g., student-teacher ratios)


### Health

-   Mortality (infant mortality, 1000 inhabitants)

-   Disease prevalence (Dengue, tuberculosis, HIV)

-   Vaccination (pentavalent, triple viral)


### Covariates

Interested in both time-variant and time-invariant information.

-   Time-variant

    -   Population and density (rural and total)

    -   PIB per capita

    -   Gini

-   Time-invariant

    -   elevation (proxy for difficult access)

    -   distance from state capital


# Save the dataset as .csv

```{r, DF_CMPD, include=TRUE, echo=FALSE, results='asis'}

# write.csv(Col2018, file = "Col2018.csv", row.names = FALSE)


```


