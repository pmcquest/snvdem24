mutate(elsnmr_3m  = case_when(
VAM18_2 > 138 ~ v13_col_sn_2018$v2elsnmrfc_3, TRUE ~ NA_real_)) %>%
#"stronger civil liberties"
mutate(clrgst_3m  = case_when(
VAM18_2 > 138 ~ v13_col_sn_2018$v2clrgstch_3, TRUE ~ NA_real_)) %>%
#"weaker civil liberties"
mutate(clrgwk_3m  = case_when(
VAM18_2 > 138 ~ v13_col_sn_2018$v2clrgwkch_3, TRUE ~ NA_real_)) %>%
## at the departmental level
#"less free and fair subnational elections"
mutate(elsnl_3d = case_when(
PBID18_2 > 26884 ~ v13_col_sn_2018$v2elsnlfc_3, TRUE ~ NA_real_)) %>%
#"more free and fair subnational elections"
mutate(elsnmr_3d = case_when(
PBID18_2 > 26884 ~ v13_col_sn_2018$v2elsnmrfc_3, TRUE ~ NA_real_)) %>%
#"stronger civil liberties"
mutate(clrgst_3d = case_when(
PBID18_2 > 26884 ~ v13_col_sn_2018$v2clrgstch_3, TRUE ~ NA_real_)) %>%
#"weaker civil liberties"
mutate(clrgwk_3d = case_when(
PBID18_2 > 26884 ~ v13_col_sn_2018$v2clrgwkch_3, TRUE ~ NA_real_))
# Export V-Dem merged data to a .csv file that will be joined to map
write.csv(ED_18, file = "G:/My Drive/git/snvdem24/data/geospatial/2018pmq/2-3_EconDevt/ED18_2-3.csv", row.names = FALSE)
# Export V-Dem merged data to a .csv file that will be joined to map
write.csv(ED18_2_3, file = "G:/My Drive/git/snvdem24/data/geospatial/2018pmq/2-3_EconDevt/ED18_2-3.csv", row.names = FALSE)
# make a clean slate
rm(list = ls())
# load needed packages
library(tidyverse)
library(vdemdata)
# Create a data frame of version 13 dataset:
v13 <- vdem
# this df appears to be the same as MC's "full + others" data set: read_dta("C:/Users/mcoppedg/Dropbox/MC/VDemFiles/Archive/V13/V-Dem-CY-Full+Others/V-Dem-CY-Full+Others-v13.dta")
# Filter to just Colombia since 1899:
v13_col <- filter(v13, country_name=="Colombia" & year > 1899)
# Select just the ID and subnational variables
# (Note: v2elsnless and v2elsnmore are not in this df. We will make sure to
# include them in our request to the data manager.)
v13_col_sn <- v13_col %>%
select(country_id, country_name, country_text_id, historical_date, year,
v2elsnlfc_0:v2elsnlfc_21, v2elsnmrfc_0:v2elsnmrfc_21,
v2clrgstch_0:v2clrgstch_21, v2clrgwkch_0:v2clrgwkch_21)
# Listing the variable names to check our work:
#names(v13_col_sn)
# Export the result to a CSV file:
#write.csv(v13_col_sn, file = "v13_col_sn.csv")
# create subset of V-Dem data for 2018
v13_col_sn_2018 <- subset(v13_col_sn, year == 2018)
v13_col_sn_2018 <- v13_col_sn_2018 %>%
select(-matches("_17$|_18$|_19$|_20$|_21$")) # remove responses not relevant for Colombia
df2rm = c("v13", "v13_col", "v13_col_sn", "df2rm")
rm(list = df2rm)
library(readxl)
MGN18 <- read_excel("G:/My Drive/git/snvdem24/data/geospatial/MGN_ANM_MPIOS/MGN18.xls")
# We select only relevant variables for merging purposes.
# colnames(MGN18)
MGN18 <- MGN18 %>%
select(1:7)
#data from DANE regions requires some formatting before merging
reg <- read_csv("G:/My Drive/git/snvdem24/data/geospatial/2018pmq/6-9_Cardinal/Departamentos_y_municipios_de_Colombia_20240312.csv")
reg <- reg %>%
rename(mpio = `CÓDIGO DANE DEL MUNICIPIO`)
reg$MPIO_CDPMP <- sprintf("%.3f", reg$mpio) #Codigo municipio should have 5 digits
reg$MPIO_CDPMP <- gsub("\\.", "", reg$MPIO_CDPMP)
reg$MPIO_CDPMP <- ifelse(nchar(reg$MPIO_CDPMP) == 4, sprintf("0%s", reg$MPIO_CDPMP), reg$MPIO_CDPMP)
# merge base-layer dataset to obtain FID variable (for later integration with ArcMaps)
reg <- merge(reg, MGN18[, c("MPIO_CDPMP", "FID")], by = "MPIO_CDPMP", all.x = TRUE)
unique(reg$REGION)
reg <- reg %>%
mutate(Cardinal = case_when(
REGION %in% c('Región Caribe', 'Región Eje Cafetero - Antioquia') ~ 'North',
REGION %in% c('Región Centro Oriente', 'Región Llano') ~ 'East',
REGION == 'Región Centro Sur' ~ 'South',
REGION == 'Región Pacífico' ~ 'West',
TRUE ~ NA_character_
))
reg <- reg %>%
mutate(elsnlfc = case_when(
Cardinal == "North" ~ v13_col_sn_2018$v2elsnlfc_6,
Cardinal == "South" ~ v13_col_sn_2018$v2elsnlfc_7,
Cardinal == "West" ~ v13_col_sn_2018$v2elsnlfc_8,
Cardinal == "East" ~ v13_col_sn_2018$v2elsnlfc_9,
# Add conditions for other values of Cardinal if needed
TRUE ~ NA_real_ # Default value if none of the conditions match
))
# "more free and fair subnational elections"
reg <- reg %>%
mutate(elsnmrfc = case_when(
Cardinal == "North" ~ v13_col_sn_2018$v2elsnmrfc_6,
Cardinal == "South" ~ v13_col_sn_2018$v2elsnmrfc_7,
Cardinal == "West" ~ v13_col_sn_2018$v2elsnmrfc_8,
Cardinal == "East" ~ v13_col_sn_2018$v2elsnmrfc_9,
# Add conditions for other values of Cardinal if needed
TRUE ~ NA_real_ # Default value if none of the conditions match
))
# "stronger civil liberties"
reg <- reg %>%
mutate(clrgstch = case_when(
Cardinal == "North" ~ v13_col_sn_2018$v2clrgstch_6,
Cardinal == "South" ~ v13_col_sn_2018$v2clrgstch_7,
Cardinal == "West" ~ v13_col_sn_2018$v2clrgstch_8,
Cardinal == "East" ~ v13_col_sn_2018$v2clrgstch_9,
# Add conditions for other values of Cardinal if needed
TRUE ~ NA_real_ # Default value if none of the conditions match
))
# "weaker civil liberties"
reg <- reg %>%
mutate(clrgwkch = case_when(
Cardinal == "North" ~ v13_col_sn_2018$v2clrgwkch_6,
Cardinal == "South" ~ v13_col_sn_2018$v2clrgwkch_7,
Cardinal == "West" ~ v13_col_sn_2018$v2clrgwkch_8,
Cardinal == "East" ~ v13_col_sn_2018$v2clrgwkch_9,
# Add conditions for other values of Cardinal if needed
TRUE ~ NA_real_ # Default value if none of the conditions match
))
# Export the final merge to a .csv file that can be read into ArcMaps
reg_6 <- reg %>%
select(1:2|7:12)
# Export the final merge to a .csv file that can be read into ArcMaps
reg_6 <- reg %>%
select(7:12) %>%
rename(FID_6 = FID) %>%
rename(Card_6 = Cardinal) %>%
rename(elsnl_6 = elsnlfc) %>%
rename(elsnmr_6 = elsnmrfc) %>%
rename(clrgst_6 = clrgstch) %>%
rename(clrgwk_6 = clrgwkch)
View(reg_6)
View(reg)
# Export the final merge to a .csv file that can be read into ArcMaps
CD18_6_9 <- reg %>%
select(7:12) %>%
rename(FID_6 = FID) %>%
rename(Card_6 = Cardinal) %>%
rename(elsnl_6 = elsnlfc) %>%
rename(elsnmr_6 = elsnmrfc) %>%
rename(clrgst_6 = clrgstch) %>%
rename(clrgwk_6 = clrgwkch)
CD18_6_9 <- CD18_6_9[complete.cases(CD18_6_9$FID_6), ]
write.csv(CD18_6_9, file = "G:/My Drive/git/snvdem24/data/geospatial/2018pmq/6-9_Cardinal/CD18_6-9.csv", row.names = FALSE)
knitr::opts_chunk$set(echo = TRUE)
setwd("G:/My Drive/git/snvdem24")
# make a clean slate
rm(list = ls())
# load needed packages
library(tidyverse)
library(vdemdata)
# Create a data frame of version 13 dataset:
v13 <- vdem
# this df appears to be the same as MC's "full + others" data set: read_dta("C:/Users/mcoppedg/Dropbox/MC/VDemFiles/Archive/V13/V-Dem-CY-Full+Others/V-Dem-CY-Full+Others-v13.dta")
# Filter to just Colombia since 1899:
v13_col <- filter(v13, country_name=="Colombia" & year > 1899)
# Select just the ID and subnational variables
# (Note: v2elsnless and v2elsnmore are not in this df. We will make sure to
# include them in our request to the data manager.)
v13_col_sn <- v13_col %>%
select(country_id, country_name, country_text_id, historical_date, year,
v2elsnlfc_0:v2elsnlfc_21, v2elsnmrfc_0:v2elsnmrfc_21,
v2clrgstch_0:v2clrgstch_21, v2clrgwkch_0:v2clrgwkch_21)
# Listing the variable names to check our work:
#names(v13_col_sn)
# Export the result to a CSV file:
#write.csv(v13_col_sn, file = "v13_col_sn.csv")
# create subset of V-Dem data for 2018
v13_col_sn_2018 <- subset(v13_col_sn, year == 2018)
v13_col_sn_2018 <- v13_col_sn_2018 %>%
select(-matches("_17$|_18$|_19$|_20$|_21$")) # remove responses not relevant for Colombia
df2rm = c("v13", "v13_col", "v13_col_sn", "df2rm")
rm(list = df2rm)
library(readxl)
MGN18 <- read_excel("G:/My Drive/git/snvdem24/data/geospatial/MGN_ANM_MPIOS/MGN18.xls")
# We select only relevant variables for merging purposes.
# colnames(MGN18)
MGN18 <- MGN18 %>%
select(1:7)
# Import voting data from Registraduria (RNEC).
library(readr)
rp18 <- read_csv("G:/My Drive/git/snvdem24/data/geospatial/2018pmq/15-16_RulingParty/2018_presidencia_segunda_vuelta_dta_c27d4515ed.csv") # this long dataset contains only 2 candidates because it was a second-round election. other datasets will include more rows depending on the number of candidates running.
#Codigo municipio should have 5 digits
rp18$MPIO_CDPMP <- as.character(rp18$codmpio)
rp18$MPIO_CDPMP <- ifelse(nchar(rp18$MPIO_CDPMP) == 4, sprintf("0%s", rp18$MPIO_CDPMP), rp18$MPIO_CDPMP)
# merge base-layer dataset to obtain FID variable (for later integration with ArcMaps)
rp18 <- merge(rp18, MGN18[, c("MPIO_CDPMP", "FID")], by = "MPIO_CDPMP", all.x = TRUE)
library(dplyr)
# Step 1: Calculate total votes cast at municipal level (allows for percentages later on).
rp18 <- rp18 %>%
group_by(FID) %>%
mutate(votototal = sum(votos)) %>%
mutate(vtpc = votos/votototal) %>% #optional: useful for quick look at percentages, SD, etc.
mutate(vtpc0 = round(vtpc*100, 2))
# For mapping at the municipal level, values may take the form of: percent difference in votes between top winner and runner-up candidate(s). This requires a few steps:
#Step 2: Pivot municipal voting behavior into wide format.
p18d0 <- rp18 %>%
group_by(FID, codigo_lista) %>%
pivot_wider(names_from = codigo_lista, values_from = votos) %>% # Pivot to wide format
rename(Petro = `1`,
Duque = `2`,
nomark = `997`,
null = `998`,
blank = `999`)
## Step 3: Create new dfs for voting behavior at municipal level -- is there a more efficient code?
p18d2 <- p18d0 %>%
select(FID, Petro) %>%
filter(!is.na(Petro))
p18d2 <- p18d2[!duplicated(p18d2$FID), ]
p18d3 <- p18d0 %>%
select(FID, Duque) %>%
filter(!is.na(Duque))
p18d3 <- p18d3[!duplicated(p18d3$FID), ]
p18d4 <- p18d0 %>%
select(FID, nomark) %>%
filter(!is.na(nomark))
p18d4 <- p18d4[!duplicated(p18d4$FID), ]
p18d5 <- p18d0 %>%
select(FID, null) %>%
filter(!is.na(null))
p18d5 <- p18d5[!duplicated(p18d5$FID), ]
p18d6 <- p18d0 %>%
select(FID, blank) %>%
filter(!is.na(blank))
p18d6 <- p18d6[!duplicated(p18d6$FID), ]
p18d7 <- p18d0 %>%
group_by(FID) %>%
summarise(vtotal = first(votototal))
p18d7 <- p18d7[!duplicated(p18d7$FID), ]
RPs <- list(p18d2, p18d3, p18d4, p18d5, p18d6, p18d7)
merged_RP <- Reduce(function(x, y) merge(x, y, by = "FID", all = TRUE), RPs)
df2rm2 = c("rp18", "p18d0", "p18d2", "p18d3", "p18d4", "p18d5", "p18d6", "p18d7", "df2rm2", "RPs")
rm(list = df2rm2)
## Step 3: Create margin of support variable for winner and runner-up candidates. Positive value indicates support for winner; negative indicates opposition. Variable order may vary depending on the election year data from RNEC
RP_15 <- merged_RP %>%
mutate(MOV_top2 = Duque-Petro) %>% #Raw vote-count margin of victory
mutate(Duque_pct = Duque/vtotal) %>%
mutate(Petro_pct = Petro/vtotal) %>%
mutate(MOV_top2_pct = Duque_pct-Petro_pct) #Standardized percent margin of victory
RP_15 <- RP_15 %>%
#"less free and fair subnational elections"
mutate(elsnlfc_15 = case_when(
MOV_top2_pct > 0.10 ~ v13_col_sn_2018$v2elsnlfc_15, TRUE ~ NA_real_)) %>%
#"more free and fair subnational elections"
mutate(elsnmrfc_15 = case_when(
MOV_top2_pct > 0.10 ~ v13_col_sn_2018$v2elsnmrfc_15, TRUE ~ NA_real_)) %>%
#"stronger civil liberties"
mutate(v2clrgstch_15 = case_when(
MOV_top2_pct > 0.10 ~ v13_col_sn_2018$v2clrgstch_15, TRUE ~ NA_real_)) %>%
#"weaker civil liberties"
mutate(v2clrgwkch_15 = case_when(
MOV_top2_pct > 0.10 ~ v13_col_sn_2018$v2clrgwkch_15, TRUE ~ NA_real_))
#Q16: in "areas where support [10% MOV] for the national ruling party is weak" there are ...
RP_15 <- RP_15 %>%
#"less free and fair subnational elections"
mutate(elsnlfc_16 = case_when(
MOV_top2_pct < -0.10 ~ v13_col_sn_2018$v2elsnlfc_16, TRUE ~ NA_real_)) %>%
#"more free and fair subnational elections"
mutate(elsnmrfc_16 = case_when(
MOV_top2_pct < -0.10 ~ v13_col_sn_2018$v2elsnmrfc_16, TRUE ~ NA_real_)) %>%
#"stronger civil liberties"
mutate(v2clrgstch_16 = case_when(
MOV_top2_pct < -0.10 ~ v13_col_sn_2018$v2clrgstch_16, TRUE ~ NA_real_)) %>%
#"weaker civil liberties"
mutate(v2clrgwkch_16 = case_when(
MOV_top2_pct < -0.10 ~ v13_col_sn_2018$v2clrgwkch_16, TRUE ~ NA_real_))
RP_15 <- RP_15[complete.cases(RP_15$FID), ] # remove NA case
rm(RP_15)
library(dplyr)
# Step 1: Calculate total votes cast at municipal level (allows for percentages later on).
rp18 <- rp18 %>%
group_by(FID) %>%
mutate(votototal = sum(votos)) %>%
mutate(vtpc = votos/votototal) %>% #optional: useful for quick look at percentages, SD, etc.
mutate(vtpc0 = round(vtpc*100, 2))
# Import voting data from Registraduria (RNEC).
library(readr)
rp18 <- read_csv("G:/My Drive/git/snvdem24/data/geospatial/2018pmq/15-16_RulingParty/2018_presidencia_segunda_vuelta_dta_c27d4515ed.csv") # this long dataset contains only 2 candidates because it was a second-round election. other datasets will include more rows depending on the number of candidates running.
#Codigo municipio should have 5 digits
rp18$MPIO_CDPMP <- as.character(rp18$codmpio)
rp18$MPIO_CDPMP <- ifelse(nchar(rp18$MPIO_CDPMP) == 4, sprintf("0%s", rp18$MPIO_CDPMP), rp18$MPIO_CDPMP)
# merge base-layer dataset to obtain FID variable (for later integration with ArcMaps)
rp18 <- merge(rp18, MGN18[, c("MPIO_CDPMP", "FID")], by = "MPIO_CDPMP", all.x = TRUE)
library(dplyr)
# Step 1: Calculate total votes cast at municipal level (allows for percentages later on).
rp18 <- rp18 %>%
group_by(FID) %>%
mutate(votototal = sum(votos)) %>%
mutate(vtpc = votos/votototal) %>% #optional: useful for quick look at percentages, SD, etc.
mutate(vtpc0 = round(vtpc*100, 2))
# For mapping at the municipal level, values may take the form of: percent difference in votes between top winner and runner-up candidate(s). This requires a few steps:
#Step 2: Pivot municipal voting behavior into wide format.
p18d0 <- rp18 %>%
group_by(FID, codigo_lista) %>%
pivot_wider(names_from = codigo_lista, values_from = votos) %>% # Pivot to wide format
rename(Petro = `1`,
Duque = `2`,
nomark = `997`,
null = `998`,
blank = `999`)
## Step 3: Create new dfs for voting behavior at municipal level -- is there a more efficient code?
p18d2 <- p18d0 %>%
select(FID, Petro) %>%
filter(!is.na(Petro))
p18d2 <- p18d2[!duplicated(p18d2$FID), ]
p18d3 <- p18d0 %>%
select(FID, Duque) %>%
filter(!is.na(Duque))
p18d3 <- p18d3[!duplicated(p18d3$FID), ]
p18d4 <- p18d0 %>%
select(FID, nomark) %>%
filter(!is.na(nomark))
p18d4 <- p18d4[!duplicated(p18d4$FID), ]
p18d5 <- p18d0 %>%
select(FID, null) %>%
filter(!is.na(null))
p18d5 <- p18d5[!duplicated(p18d5$FID), ]
p18d6 <- p18d0 %>%
select(FID, blank) %>%
filter(!is.na(blank))
p18d6 <- p18d6[!duplicated(p18d6$FID), ]
p18d7 <- p18d0 %>%
group_by(FID) %>%
summarise(vtotal = first(votototal))
p18d7 <- p18d7[!duplicated(p18d7$FID), ]
RPs <- list(p18d2, p18d3, p18d4, p18d5, p18d6, p18d7)
merged_RP <- Reduce(function(x, y) merge(x, y, by = "FID", all = TRUE), RPs)
df2rm2 = c("rp18", "p18d0", "p18d2", "p18d3", "p18d4", "p18d5", "p18d6", "p18d7", "df2rm2", "RPs")
rm(list = df2rm2)
## Step 3: Create margin of support variable for winner and runner-up candidates. Positive value indicates support for winner; negative indicates opposition. Variable order may vary depending on the election year data from RNEC
RP_15 <- merged_RP %>%
mutate(MOV_top2 = Duque-Petro) %>% #Raw vote-count margin of victory
mutate(Duque_pct = Duque/vtotal) %>%
mutate(Petro_pct = Petro/vtotal) %>%
mutate(MOV_pct = Duque_pct-Petro_pct) #Standardized percent margin of victory
#Q15: in "areas where support [10% MOV] for the national ruling party is strong" there are ...
RP_15 <- RP_15 %>%
#"less free and fair subnational elections"
mutate(elsnlf_15 = case_when(
MOV_top2_pct > 0.10 ~ v13_col_sn_2018$v2elsnlfc_15, TRUE ~ NA_real_)) %>%
#"more free and fair subnational elections"
mutate(elsnmr_15 = case_when(
MOV_top2_pct > 0.10 ~ v13_col_sn_2018$v2elsnmrfc_15, TRUE ~ NA_real_)) %>%
#"stronger civil liberties"
mutate(clrgst_15 = case_when(
MOV_top2_pct > 0.10 ~ v13_col_sn_2018$v2clrgstch_15, TRUE ~ NA_real_)) %>%
#"weaker civil liberties"
mutate(clrgwk_15 = case_when(
MOV_top2_pct > 0.10 ~ v13_col_sn_2018$v2clrgwkch_15, TRUE ~ NA_real_))
#Q15: in "areas where support [10% MOV] for the national ruling party is strong" there are ...
RP_15 <- RP_15 %>%
#"less free and fair subnational elections"
mutate(elsnlf_15 = case_when(
MOV_pct > 0.10 ~ v13_col_sn_2018$v2elsnlfc_15, TRUE ~ NA_real_)) %>%
#"more free and fair subnational elections"
mutate(elsnmr_15 = case_when(
MOV_pct > 0.10 ~ v13_col_sn_2018$v2elsnmrfc_15, TRUE ~ NA_real_)) %>%
#"stronger civil liberties"
mutate(clrgst_15 = case_when(
MOV_pct > 0.10 ~ v13_col_sn_2018$v2clrgstch_15, TRUE ~ NA_real_)) %>%
#"weaker civil liberties"
mutate(clrgwk_15 = case_when(
MOV_pct > 0.10 ~ v13_col_sn_2018$v2clrgwkch_15, TRUE ~ NA_real_))
#Q16: in "areas where support [10% MOV] for the national ruling party is weak" there are ...
RP_15 <- RP_15 %>%
#"less free and fair subnational elections"
mutate(elsnl_16 = case_when(
MOV_pct < -0.10 ~ v13_col_sn_2018$v2elsnlfc_16, TRUE ~ NA_real_)) %>%
#"more free and fair subnational elections"
mutate(elsnmr_16 = case_when(
MOV_pct < -0.10 ~ v13_col_sn_2018$v2elsnmrfc_16, TRUE ~ NA_real_)) %>%
#"stronger civil liberties"
mutate(clrgst_16 = case_when(
MOV_pct < -0.10 ~ v13_col_sn_2018$v2clrgstch_16, TRUE ~ NA_real_)) %>%
#"weaker civil liberties"
mutate(clrgwk_16 = case_when(
MOV_pct < -0.10 ~ v13_col_sn_2018$v2clrgwkch_16, TRUE ~ NA_real_))
library(dplyr)
# Step 1: Calculate total votes cast at municipal level (allows for percentages later on).
rp18 <- rp18 %>%
group_by(FID) %>%
mutate(votototal = sum(votos)) %>%
mutate(vtpc = votos/votototal) %>% #optional: useful for quick look at percentages, SD, etc.
mutate(vtpc0 = round(vtpc*100, 2))
# Import voting data from Registraduria (RNEC).
library(readr)
rp18 <- read_csv("G:/My Drive/git/snvdem24/data/geospatial/2018pmq/15-16_RulingParty/2018_presidencia_segunda_vuelta_dta_c27d4515ed.csv") # this long dataset contains only 2 candidates because it was a second-round election. other datasets will include more rows depending on the number of candidates running.
#Codigo municipio should have 5 digits
rp18$MPIO_CDPMP <- as.character(rp18$codmpio)
rp18$MPIO_CDPMP <- ifelse(nchar(rp18$MPIO_CDPMP) == 4, sprintf("0%s", rp18$MPIO_CDPMP), rp18$MPIO_CDPMP)
# merge base-layer dataset to obtain FID variable (for later integration with ArcMaps)
rp18 <- merge(rp18, MGN18[, c("MPIO_CDPMP", "FID")], by = "MPIO_CDPMP", all.x = TRUE)
library(dplyr)
# Step 1: Calculate total votes cast at municipal level (allows for percentages later on).
rp18 <- rp18 %>%
group_by(FID) %>%
mutate(votototal = sum(votos)) %>%
mutate(vtpc = votos/votototal) %>% #optional: useful for quick look at percentages, SD, etc.
mutate(vtpc0 = round(vtpc*100, 2))
# For mapping at the municipal level, values may take the form of: percent difference in votes between top winner and runner-up candidate(s). This requires a few steps:
#Step 2: Pivot municipal voting behavior into wide format.
p18d0 <- rp18 %>%
group_by(FID, codigo_lista) %>%
pivot_wider(names_from = codigo_lista, values_from = votos) %>% # Pivot to wide format
rename(Petro = `1`,
Duque = `2`,
nomark = `997`,
null = `998`,
blank = `999`)
## Step 3: Create new dfs for voting behavior at municipal level -- is there a more efficient code?
p18d2 <- p18d0 %>%
select(FID, Petro) %>%
filter(!is.na(Petro))
p18d2 <- p18d2[!duplicated(p18d2$FID), ]
p18d3 <- p18d0 %>%
select(FID, Duque) %>%
filter(!is.na(Duque))
p18d3 <- p18d3[!duplicated(p18d3$FID), ]
p18d4 <- p18d0 %>%
select(FID, nomark) %>%
filter(!is.na(nomark))
p18d4 <- p18d4[!duplicated(p18d4$FID), ]
p18d5 <- p18d0 %>%
select(FID, null) %>%
filter(!is.na(null))
p18d5 <- p18d5[!duplicated(p18d5$FID), ]
p18d6 <- p18d0 %>%
select(FID, blank) %>%
filter(!is.na(blank))
p18d6 <- p18d6[!duplicated(p18d6$FID), ]
p18d7 <- p18d0 %>%
group_by(FID) %>%
summarise(vtotal = first(votototal))
p18d7 <- p18d7[!duplicated(p18d7$FID), ]
RPs <- list(p18d2, p18d3, p18d4, p18d5, p18d6, p18d7)
merged_RP <- Reduce(function(x, y) merge(x, y, by = "FID", all = TRUE), RPs)
df2rm2 = c("rp18", "p18d0", "p18d2", "p18d3", "p18d4", "p18d5", "p18d6", "p18d7", "df2rm2", "RPs")
rm(list = df2rm2)
## Step 3: Create margin of support variable for winner and runner-up candidates. Positive value indicates support for winner; negative indicates opposition. Variable order may vary depending on the election year data from RNEC
RP_15 <- merged_RP %>%
mutate(MOV_top2 = Duque-Petro) %>% #Raw vote-count margin of victory
mutate(Duque_pct = Duque/vtotal) %>%
mutate(Petro_pct = Petro/vtotal) %>%
mutate(MOV_pct = Duque_pct-Petro_pct) #Standardized percent margin of victory
mean(RP_15$MOV_top2_pct) #Duque margin is 26.3% on average (quite high).
sd(RP_15$MOV_top2_pct) #SD for the margin is larger than the mean (39.7%) suggesting abnormal distribution
hist(RP_15$MOV_top2_pct, main = "Histogram of MOV", xlab = "MOV", col = "skyblue", border = "black") #left-tail long (margin for Petro)
#Q15: in "areas where support [10% MOV] for the national ruling party is strong" there are ...
RP_15 <- RP_15 %>%
#"less free and fair subnational elections"
mutate(elsnl_15 = case_when(
MOV_pct > 0.10 ~ v13_col_sn_2018$v2elsnlfc_15, TRUE ~ NA_real_)) %>%
#"more free and fair subnational elections"
mutate(elsnmr_15 = case_when(
MOV_pct > 0.10 ~ v13_col_sn_2018$v2elsnmrfc_15, TRUE ~ NA_real_)) %>%
#"stronger civil liberties"
mutate(clrgst_15 = case_when(
MOV_pct > 0.10 ~ v13_col_sn_2018$v2clrgstch_15, TRUE ~ NA_real_)) %>%
#"weaker civil liberties"
mutate(clrgwk_15 = case_when(
MOV_pct > 0.10 ~ v13_col_sn_2018$v2clrgwkch_15, TRUE ~ NA_real_))
#Q16: in "areas where support [10% MOV] for the national ruling party is weak" there are ...
RP_15 <- RP_15 %>%
#"less free and fair subnational elections"
mutate(elsnl_16 = case_when(
MOV_pct < -0.10 ~ v13_col_sn_2018$v2elsnlfc_16, TRUE ~ NA_real_)) %>%
#"more free and fair subnational elections"
mutate(elsnmr_16 = case_when(
MOV_pct < -0.10 ~ v13_col_sn_2018$v2elsnmrfc_16, TRUE ~ NA_real_)) %>%
#"stronger civil liberties"
mutate(clrgst_16 = case_when(
MOV_pct < -0.10 ~ v13_col_sn_2018$v2clrgstch_16, TRUE ~ NA_real_)) %>%
#"weaker civil liberties"
mutate(clrgwk_16 = case_when(
MOV_pct < -0.10 ~ v13_col_sn_2018$v2clrgwkch_16, TRUE ~ NA_real_))
RP_15 <- RP_15[complete.cases(RP_15$FID), ] # remove NA case
# Export the final merge to a .csv file that can be read into ArcMaps
RP18_15 <- RP_15 %>%
select(1:3|7|11:19) %>%
rename(FID_15 = FID) %>%
rename(Petro_15 = Petro) %>%
rename(Duque_15 = Duque) %>%
rename(vtotal_15 = elsnmrfc) %>%
rename(MOV18_15 = clrgstch)
# Export the final merge to a .csv file that can be read into ArcMaps
RP18_15 <- RP_15 %>%
select(1:3|7|11:19) %>%
rename(FID_15 = FID) %>%
rename(Petro_15 = Petro) %>%
rename(Duque_15 = Duque) %>%
rename(vtotal_15 = vtotal) %>%
rename(MOV18_15 = MOV_pct)
# Export data to a csv file that will be joined to map
write.csv(RP18_15, file = "G:/My Drive/git/snvdem24/data/geospatial/2018pmq/15-16_RulingParty/RP18_15-16.csv", row.names = FALSE)
# Export data to a csv file that will be joined to map
write.csv(RP18_15, file = "G:/My Drive/git/snvdem24/data/geospatial/2018pmq/15-16_RulingParty/RP18_15-16a.csv", row.names = FALSE)
# Export the final merge to a .csv file that can be read into ArcMaps
RP18_15 <- RP_15 %>%
select(1:3|7|11:19) %>%
rename(FID_15 = FID) %>%
rename(Petro_15 = Petro) %>%
rename(Duque_15 = Duque) %>%
rename(vtotal_15 = vtotal) %>%
rename(MOV18_15 = MOV_pct) %>%
mutate(MOV18_5 = round(MOV18_5, 5))
# Export the final merge to a .csv file that can be read into ArcMaps
RP18_15 <- RP_15 %>%
select(1:3|7|11:19) %>%
rename(FID_15 = FID) %>%
rename(Petro_15 = Petro) %>%
rename(Duque_15 = Duque) %>%
rename(vtotal_15 = vtotal) %>%
rename(MOV18_15 = MOV_pct) %>%
mutate(MOV18_15 = round(MOV18_15, 5))
# Export data to a csv file that will be joined to map
write.csv(RP18_15, file = "G:/My Drive/git/snvdem24/data/geospatial/2018pmq/15-16_RulingParty/RP18_15-16a.csv", row.names = FALSE)
